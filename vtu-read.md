---
title: vtu文件的读取
date: 2019-11-05 23:07:17
tags:
 - vtk
 - pi-BEM
categories:
 - vtk
---

# .vtu 文件的读取

在运行pi-BEM之后，结果用.vtu文件保存，有

* mesh.vtu
* result_scalar_results.vtu
* result_vector_results.vtu
* scalar_error.vtu
* vector_error.vtu

文件中存储的数组信息，但是结果无法直接读取，可以看出其为xml文件，为vtk存储的非结构网格，网格点数量为80个，有40个单元。xml文件分为三个部分，第一部分为Points，存储节点的坐标；第二部分为Cells，存储单元的节点信息，如第一个单元的两个端点为1，2号节点；第三部分为PointData（Scalar），存储一些数据，一下展示的是mesh.vtu,所以数据为partition，在其它文件中存储的是更为有意义的数据。

```xml
<?xml version="1.0" ?> 
<!-- 
# vtk DataFile Version 3.0
#This file was generated by the deal.II library on 10:36:12 at 2019/10/16
-->
<VTKFile type="UnstructuredGrid" version="0.1" compressor="vtkZLibDataCompressor" byte_order="LittleEndian">
<UnstructuredGrid>
<Piece NumberOfPoints="80" NumberOfCells="40" >
  <Points>
    <DataArray type="Float32" NumberOfComponents="3" format="binary">
AQAAAMADAADAAwAA1QAAAA==eNpl07EJAkEUBNATrEEUEwPNTcRst4QrwNQGFhMVg6vEyDbUOuzA3AZkuOHzmRGUB7f8m/mLXYfPUPF72K7K5nMzX/f30s4nc2vfMlkczfPLrD6Xvfk33VV81XiOc2rMw1w13o8cauRFbvXYb1ireeal5kwzM5iZ+a1mRzN3YuYOzdy5mXdkZk8z+qXzYfRL88Pol/KE0S/lD6Nf6hvG87SfMOalfYbx/rT/MPKm+wqP/YaHmmeKmjPNzGBm5qpmRzN3YuYOzdy5mXdk7tJ/9g/msPPp
    </DataArray>
  </Points>

  <Cells>
    <DataArray type="Int32" Name="connectivity" format="binary">
AQAAAEABAABAAQAAhQAAAA==eNoNw4c2QgEAANBHpSHRUAhF00pWQyVNlPj/v+nec24QBMGOu4YMG3HPqDHjJtw36YEpDz0ybcasOY/NW/DEU88seu6Fl5Yse+W1FavWrNuw6Y233nnvgy0fbfvksy+++mbHrj37vjtw6MgPx346cerMuQuXfvntjyvX/rrxz3+3NqsMWQ==
    </DataArray>
    <DataArray type="Int32" Name="offsets" format="binary">
AQAAAKAAAACgAAAAUwAAAA==eNoNw4EGwlAAAMBnJjOTJMlkMjOTJJNMJpNMZrL//5ruuCiEELsyMTVz7catO/cezD1aeLK0srbx7MWrN1vvPux82vty8O3H0a+Tsz8X/2dvBmk=
    </DataArray>
    <DataArray type="UInt8" Name="types" format="binary">
AQAAACgAAAAoAAAADAAAAA==eNpjZiYOAAAJxAB5
    </DataArray>
  </Cells>
  <PointData Scalars="scalars">
    <DataArray type="Float32" Name="partitioning" format="binary">
AQAAAEABAABAAQAADQAAAA==eNpjYBgFlAAAAUAAAQ==    </DataArray>
  </PointData>
 </Piece>
 </UnstructuredGrid>
</VTKFile>
```

利用python的vtk库，可以将其转化成numpy数组。

```python
import vtk
import numpy as np
from vtk.util.numpy_support import vtk_to_numpy

def read_vtk(filename):
    reader = vtk.vtkXMLUnstructuredGridReader()
    reader.SetFileName(filename)
    reader.Update()
    nodes_vtk_array= vtk_to_numpy(reader.GetOutput().GetPoints().GetData())
    data_vtk_array= vtk_to_numpy(reader.GetOutput().GetPointData().GetArray(0))
    return nodes_vtk_array,data_vtk_array

filename = 'mesh.vtu'
tmp = read_vtk(filename)
print(tmp[0].shape)
print(tmp[1].shape)
```

输出的结果为

```bash
(80, 3)
(80,)
```

数组中有80个单元，每个单元有x，y，t三个变量，输出符合预期。每个单元的有一个partition数据，所以为$80 \times 1$的数组。